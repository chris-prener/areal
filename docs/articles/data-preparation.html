<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preparing Data for Interpolation • areal</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Preparing Data for Interpolation">
<meta property="og:description" content="areal">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">areal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/areal.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/slu-openGIS/areal/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="data-preparation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Preparing Data for Interpolation</h1>
                        <h4 class="author">Christopher Prener, Ph.D.</h4>
            
            <h4 class="date">2020-07-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slu-openGIS/areal/blob/master/vignettes/data-preparation.Rmd"><code>vignettes/data-preparation.Rmd</code></a></small>
      <div class="hidden name"><code>data-preparation.Rmd</code></div>

    </div>

    
    
<p>Depending on the state of your spatial data, they may require some cleaning and modification before interpolation. The types of issues to address pre-interpolation fall into a few distinct categories:</p>
<ol style="list-style-type: decimal">
<li>Data are not in the right format</li>
<li>Data are not in the right coordinate system</li>
<li>Data have variable name conflicts</li>
<li>Data have too many variables or observations and therefore must be subset</li>
</ol>
<p>Each of these conditions will be discussed below. The following examples assume:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">areal</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)   <span class="co"># data wrangling</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>)      <span class="co"># spatial data operations</span>

<span class="co"># load data into enviornment</span>
<span class="no">race</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_race</span>
<span class="no">asthma</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_asthma</span>
<span class="no">wards</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_wards</span>

<span class="co"># create example data - non-spatial data</span>
<span class="no">asthmaTbl</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_asthma</span>
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">asthmaTbl</span>) <span class="kw">&lt;-</span> <span class="kw">NULL</span>

<span class="co"># create example data - wrong crs</span>
<span class="no">race83</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="no">race</span>, <span class="kw">crs</span> <span class="kw">=</span> <span class="fl">4269</span>)</pre></body></html></div>
<div id="validating-data" class="section level2">
<h2 class="hasAnchor">
<a href="#validating-data" class="anchor"></a>Validating Data</h2>
<p><code>areal</code> has a built-in tool for data validation, <code><a href="../reference/ar_validate.html">ar_validate()</a></code>, that provides an excellent starting place for ensuring your data are ready to interpolate. The validation process covers the first three issues listed in the introduction. It can be run in a simple format:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">asthma</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wards</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
<p>If <code><a href="../reference/ar_validate.html">ar_validate()</a></code> returns a <code>FALSE</code> value, it can also be run in a verbose manner that returns a detailed tibble:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">asthma</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wards</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   test                            result</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;lgl&gt; </span>
<span class="co">#&gt; 1 sf Objects                      TRUE  </span>
<span class="co">#&gt; 2 CRS Match                       TRUE  </span>
<span class="co">#&gt; 3 CRS is Planar                   TRUE  </span>
<span class="co">#&gt; 4 Variables Exist in Source       TRUE  </span>
<span class="co">#&gt; 5 No Variable Conflicts in Target TRUE  </span>
<span class="co">#&gt; 6 Overall Evaluation              TRUE</span></pre></body></html></div>
<p>Use the <code>verbose = TRUE</code> output as a checklist to address issues before interpolating your data.</p>
</div>
<div id="format-issues" class="section level2">
<h2 class="hasAnchor">
<a href="#format-issues" class="anchor"></a>Format Issues</h2>
<p>Data need to be loaded as <code>sf</code> objects in <code>R</code>. If <code><a href="../reference/ar_validate.html">ar_validate()</a></code> returns <code>FALSE</code> for the first condition, data are not stored as <code>sf</code> objects:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">asthmaTbl</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wards</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   test                            result</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;lgl&gt; </span>
<span class="co">#&gt; 1 sf Objects                      FALSE </span>
<span class="co">#&gt; 2 CRS Match                       NA    </span>
<span class="co">#&gt; 3 CRS is Planar                   NA    </span>
<span class="co">#&gt; 4 Variables Exist in Source       NA    </span>
<span class="co">#&gt; 5 No Variable Conflicts in Target NA    </span>
<span class="co">#&gt; 6 Overall Evaluation              FALSE</span></pre></body></html></div>
<div id="external-spatial-data" class="section level3">
<h3 class="hasAnchor">
<a href="#external-spatial-data" class="anchor"></a>External Spatial Data</h3>
<p>If you have external data, using <code><a href="https://rdrr.io/pkg/sf/man/st_read.html">st_read()</a></code> is the best way to load them:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="kw pkg">sf</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_read.html">st_read</a></span>(<span class="st">"data.shp"</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>The <code><a href="https://rdrr.io/pkg/sf/man/st_read.html">st_read()</a></code> function supports a variety of the most common data sources.</p>
</div>
<div id="sp-data" class="section level3">
<h3 class="hasAnchor">
<a href="#sp-data" class="anchor"></a>sp Data</h3>
<p>If you are working with data that is an <code>sp</code> object in <code>R</code>, the <code>sf</code> package has a function <code><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf()</a></code> can be used to convert the object to <code>sf</code>:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">sf_object</span> <span class="kw">&lt;-</span> <span class="kw pkg">sf</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(<span class="no">sp_object</span>)</pre></body></html></div>
</div>
<div id="data-from-tidycensus-and-tigris" class="section level3">
<h3 class="hasAnchor">
<a href="#data-from-tidycensus-and-tigris" class="anchor"></a>Data From tidycensus and tigris</h3>
<p>If you are using either the <a href="https://walkerke.github.io/tidycensus/"><code>tidycensus</code></a> or <a href="https://github.com/walkerke/tigris"><code>tigris</code></a> packages to access spatial data, there are options for downloading data as <code>sf</code> objects as well. In <code>tidycensus</code>, the <code>geometry = TRUE</code> option should be used. In <code>tigris</code>, the <code>class = "sf"</code> option should be used.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">stl_race</span> <span class="kw">&lt;-</span> <span class="kw pkg">tidycensus</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidycensus/man/get_acs.html">get_acs</a></span>(<span class="kw">geography</span> <span class="kw">=</span> <span class="st">"tract"</span>, <span class="kw">state</span> <span class="kw">=</span> <span class="fl">29</span>, <span class="kw">county</span> <span class="kw">=</span> <span class="fl">510</span>, <span class="kw">year</span> <span class="kw">=</span> <span class="fl">2017</span>,
                                <span class="kw">table</span> <span class="kw">=</span> <span class="st">"B02001"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"wide"</span>, <span class="kw">geometry</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">stl_tracts</span> <span class="kw">&lt;-</span> <span class="kw pkg">tigris</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/tigris/man/tracts.html">tracts</a></span>(<span class="kw">state</span> <span class="kw">=</span> <span class="fl">29</span>, <span class="kw">county</span> <span class="kw">=</span> <span class="fl">510</span>, <span class="kw">class</span> <span class="kw">=</span> <span class="st">"sf"</span>)</pre></body></html></div>
</div>
<div id="tabular-data" class="section level3">
<h3 class="hasAnchor">
<a href="#tabular-data" class="anchor"></a>Tabular Data</h3>
<p>If you have tabular data, you will need to merge them with a shapefile or other spatial data set that contains the geometry for the corresponding spatial features. For American users, a potentially common scenario here will be table of census geography (such as tracts) that lacks the geometry for those features. These can be downloaded using <a href="https://github.com/walkerke/tigris"><code>tigris</code></a> and then combined using <a href="https://dplyr.tidyverse.org"><code>dplyr</code></a>. The following example assumes the tract data contains an identification number column named <code>GEOID</code> with the appropriate tract identifiers for St. Louis:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">stl_tracts</span> <span class="kw">&lt;-</span> <span class="kw pkg">tigris</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/tigris/man/tracts.html">tracts</a></span>(<span class="kw">state</span> <span class="kw">=</span> <span class="fl">29</span>, <span class="kw">county</span> <span class="kw">=</span> <span class="fl">510</span>, <span class="kw">class</span> <span class="kw">=</span> <span class="st">"sf"</span>)

<span class="no">tract_data</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">stl_tracts</span>, <span class="no">asthmaTBL</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"GEOID"</span>)</pre></body></html></div>
</div>
</div>
<div id="coordinate-systems" class="section level2">
<h2 class="hasAnchor">
<a href="#coordinate-systems" class="anchor"></a>Coordinate Systems</h2>
<p>Two coordinate system rules are enforced by <code>ar_validate</code>: both the source and the target data must be in the same <a href="https://geocompr.robinlovelace.net/spatial-class.html#crs-intro">coordinate system</a> and that coordinate system must be a projected coordinate system. The <code>sf</code> package contains a function named <code><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs()</a></code> for previewing the current coordinate system of your data:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="no">race83</span>)
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt;   User input: EPSG:4269 </span>
<span class="co">#&gt;   wkt:</span>
<span class="co">#&gt; GEOGCRS["NAD83",</span>
<span class="co">#&gt;     DATUM["North American Datum 1983",</span>
<span class="co">#&gt;         ELLIPSOID["GRS 1980",6378137,298.257222101,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span>
<span class="co">#&gt;     PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     CS[ellipsoidal,2],</span>
<span class="co">#&gt;         AXIS["geodetic latitude (Lat)",north,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;         AXIS["geodetic longitude (Lon)",east,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;     USAGE[</span>
<span class="co">#&gt;         SCOPE["unknown"],</span>
<span class="co">#&gt;         AREA["North America - NAD83"],</span>
<span class="co">#&gt;         BBOX[14.92,167.65,86.46,-47.74]],</span>
<span class="co">#&gt;     ID["EPSG",4269]]</span></pre></body></html></div>
<p>The <code>EPSG</code> value <code>4269</code> refers to a specific type of coordinate system known as as geographic coordinate system. These data use latitude-longitude values, which vary in length and thus cannot be used to calculate area (a key component of carrying out areal interpolations). These data would fail the <code><a href="../reference/ar_validate.html">ar_validate()</a></code> process:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race83</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wards</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"TOTAL_E"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   test                            result</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;lgl&gt; </span>
<span class="co">#&gt; 1 sf Objects                      TRUE  </span>
<span class="co">#&gt; 2 CRS Match                       FALSE </span>
<span class="co">#&gt; 3 CRS is Planar                   FALSE </span>
<span class="co">#&gt; 4 Variables Exist in Source       TRUE  </span>
<span class="co">#&gt; 5 No Variable Conflicts in Target TRUE  </span>
<span class="co">#&gt; 6 Overall Evaluation              FALSE</span></pre></body></html></div>
<p>These data fail both the matching CRS validation and the planar CRS validation because the <code>race</code> and <code>wards</code> data are in two different coordinate systems. We’ve already seen the CRS data for <code>race</code> above so we’ll look at the <code>CRS data for</code>wards`:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="no">wards</span>)
<span class="co">#&gt; Coordinate Reference System:</span>
<span class="co">#&gt;   User input: EPSG:26915 </span>
<span class="co">#&gt;   wkt:</span>
<span class="co">#&gt; PROJCRS["NAD83 / UTM zone 15N",</span>
<span class="co">#&gt;     BASEGEOGCRS["NAD83",</span>
<span class="co">#&gt;         DATUM["North American Datum 1983",</span>
<span class="co">#&gt;             ELLIPSOID["GRS 1980",6378137,298.257222101,</span>
<span class="co">#&gt;                 LENGTHUNIT["metre",1]]],</span>
<span class="co">#&gt;         PRIMEM["Greenwich",0,</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span>
<span class="co">#&gt;         ID["EPSG",4269]],</span>
<span class="co">#&gt;     CONVERSION["UTM zone 15N",</span>
<span class="co">#&gt;         METHOD["Transverse Mercator",</span>
<span class="co">#&gt;             ID["EPSG",9807]],</span>
<span class="co">#&gt;         PARAMETER["Latitude of natural origin",0,</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433],</span>
<span class="co">#&gt;             ID["EPSG",8801]],</span>
<span class="co">#&gt;         PARAMETER["Longitude of natural origin",-93,</span>
<span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433],</span>
<span class="co">#&gt;             ID["EPSG",8802]],</span>
<span class="co">#&gt;         PARAMETER["Scale factor at natural origin",0.9996,</span>
<span class="co">#&gt;             SCALEUNIT["unity",1],</span>
<span class="co">#&gt;             ID["EPSG",8805]],</span>
<span class="co">#&gt;         PARAMETER["False easting",500000,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1],</span>
<span class="co">#&gt;             ID["EPSG",8806]],</span>
<span class="co">#&gt;         PARAMETER["False northing",0,</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1],</span>
<span class="co">#&gt;             ID["EPSG",8807]]],</span>
<span class="co">#&gt;     CS[Cartesian,2],</span>
<span class="co">#&gt;         AXIS["(E)",east,</span>
<span class="co">#&gt;             ORDER[1],</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]],</span>
<span class="co">#&gt;         AXIS["(N)",north,</span>
<span class="co">#&gt;             ORDER[2],</span>
<span class="co">#&gt;             LENGTHUNIT["metre",1]],</span>
<span class="co">#&gt;     USAGE[</span>
<span class="co">#&gt;         SCOPE["unknown"],</span>
<span class="co">#&gt;         AREA["North America - 96°W to 90°W and NAD83 by country"],</span>
<span class="co">#&gt;         BBOX[25.61,-96,84,-90]],</span>
<span class="co">#&gt;     ID["EPSG",26915]]</span></pre></body></html></div>
<p>If these data fail that process, <code><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs()</a></code> can be used to identify whether the source or the target (or both) are in an inappropriate coordinate system. The <code>EPSG</code> value <code>26915</code> refers to another type of coordinate system known as as projected coordinate system (or “planar” data). Further, <code>26915</code> is a particular type of projected coordinate system known as the <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">Universal Transverse Mercator</a> coordinate system. This is a good option for using <code>areal</code> because it is available around the world. There are a variety of tools for identifying the appropriate UTM zone, including this excellent <a href="https://mangomap.com/robertyoung/maps/69585/what-utm-zone-am-i-in-#">interactive map</a>. Once you have an EPSG zone, the website <a href="https://epsg.io">epsg.io</a> can be used to search for the appropriate <code>EPSG</code> value.</p>
<p>In this case, the <code>wards</code> data are in an appropriate system but the <code>race</code> data need to be transformed. The <code><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform()</a></code> function can be used to modify them to an appropriate coordinate system:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">raceFixed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="no">race83</span>, <span class="kw">crs</span> <span class="kw">=</span> <span class="fl">26915</span>)</pre></body></html></div>
<p>Once this is done, these data should pass the <code><a href="../reference/ar_validate.html">ar_validate()</a></code> process:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">raceFixed</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wards</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"TOTAL_E"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   test                            result</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;lgl&gt; </span>
<span class="co">#&gt; 1 sf Objects                      TRUE  </span>
<span class="co">#&gt; 2 CRS Match                       TRUE  </span>
<span class="co">#&gt; 3 CRS is Planar                   TRUE  </span>
<span class="co">#&gt; 4 Variables Exist in Source       TRUE  </span>
<span class="co">#&gt; 5 No Variable Conflicts in Target TRUE  </span>
<span class="co">#&gt; 6 Overall Evaluation              TRUE</span></pre></body></html></div>
</div>
<div id="variable-conflicts" class="section level2">
<h2 class="hasAnchor">
<a href="#variable-conflicts" class="anchor"></a>Variable Conflicts</h2>
<p>If a variable does not exist in the source data, the validation process will fail:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wards</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"TOTAL"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   test                            result</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;lgl&gt; </span>
<span class="co">#&gt; 1 sf Objects                      TRUE  </span>
<span class="co">#&gt; 2 CRS Match                       TRUE  </span>
<span class="co">#&gt; 3 CRS is Planar                   TRUE  </span>
<span class="co">#&gt; 4 Variables Exist in Source       FALSE </span>
<span class="co">#&gt; 5 No Variable Conflicts in Target TRUE  </span>
<span class="co">#&gt; 6 Overall Evaluation              FALSE</span></pre></body></html></div>
<p>In this case, the fix is as easy as correcting the typo in our <code><a href="../reference/ar_validate.html">ar_validate()</a></code> call - the variable <code>TOTAL</code> should really be <code>TOTAL_E</code>:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">race</span>)
<span class="co">#&gt;  [1] "GEOID"     "STATEFP"   "COUNTYFP"  "TRACTCE"   "NAMELSAD"  "ALAND"    </span>
<span class="co">#&gt;  [7] "AWATER"    "TOTAL_E"   "TOTAL_M"   "WHITE_E"   "WHITE_M"   "BLACK_E"  </span>
<span class="co">#&gt; [13] "BLACK_M"   "AIAN_E"    "AIAN_M"    "ASIAN_E"   "ASIAN_M"   "NHPI_E"   </span>
<span class="co">#&gt; [19] "NHPI_M"    "OTHER_E"   "OTHER_M"   "TWOPLUS_E" "TWOPLUS_M" "geometry"</span></pre></body></html></div>
<p>Another common problem is that a variable exists in both our source and target data. For instance, we could add a <code>TOTAL_E</code> variable to our target data:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">wardsVar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="no">wards</span>, <span class="kw">TOTAL_E</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>:<span class="fl">28</span>))

<span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wardsVar</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"TOTAL_E"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   test                            result</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;lgl&gt; </span>
<span class="co">#&gt; 1 sf Objects                      TRUE  </span>
<span class="co">#&gt; 2 CRS Match                       TRUE  </span>
<span class="co">#&gt; 3 CRS is Planar                   TRUE  </span>
<span class="co">#&gt; 4 Variables Exist in Source       TRUE  </span>
<span class="co">#&gt; 5 No Variable Conflicts in Target FALSE </span>
<span class="co">#&gt; 6 Overall Evaluation              FALSE</span></pre></body></html></div>
<p>Now, we fail the validation process because there is a conflict between the source and target data - <code>TOTAL_E</code> exists in both data sets. We can use the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function from <code>dplyr</code> to remove the offending variable from the target data before proceeding:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">wardsFixed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">wardsVar</span>, -<span class="no">TOTAL_E</span>)

<span class="fu"><a href="../reference/ar_validate.html">ar_validate</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">target</span> <span class="kw">=</span> <span class="no">wardsFixed</span>, <span class="kw">varList</span> <span class="kw">=</span> <span class="st">"TOTAL_E"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"aw"</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   test                            result</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;lgl&gt; </span>
<span class="co">#&gt; 1 sf Objects                      TRUE  </span>
<span class="co">#&gt; 2 CRS Match                       TRUE  </span>
<span class="co">#&gt; 3 CRS is Planar                   TRUE  </span>
<span class="co">#&gt; 4 Variables Exist in Source       TRUE  </span>
<span class="co">#&gt; 5 No Variable Conflicts in Target TRUE  </span>
<span class="co">#&gt; 6 Overall Evaluation              TRUE</span></pre></body></html></div>
<p>Another option would be to rename the column using the <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function from <code>dplyr</code> or by using another approach for renaming columns. Either option will work for <code>areal</code>’s purposes.</p>
</div>
<div id="subsetting" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting" class="anchor"></a>Subsetting</h2>
<p>One cautionary note when using <code>areal</code> is that the validation process will not check to see if too many variables or observations exist in the data. Cleaning the data ahead of time so that only the relevant observations exist can help improve performance - if you have tract data for an entire state but only need a particular city, everything will go faster if you subset these data using the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function from <code>dplyr</code>:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">countyData</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">stateData</span>, <span class="no">COUNTY</span> <span class="kw">==</span> <span class="fl">510</span>)</pre></body></html></div>
<p>Having too many columns poses an organizational problem more than anything else. We strongly encourage users to limit their interpolated data to only the needed values. For example, the <code>wards</code> data contains an <code>AREA</code> column whose units we don’t know and an <code>OBJECTID</code> column that is an artifact from its creation using an ESRI product:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">wards</span>)
<span class="co">#&gt; [1] "OBJECTID" "WARD"     "AREA"     "geometry"</span></pre></body></html></div>
<p>We can use the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function from <code>dplyr</code> to remove these before interpolation since we don’t need them:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">wardsSubset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">wards</span>, -<span class="no">OBJECTID</span>, -<span class="no">AREA</span>)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://chris-prener.github.io">Christopher Prener</a>, Charlie Revord, Branson Fox.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
