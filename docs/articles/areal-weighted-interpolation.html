<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Areal Weighted Interpolation • areal</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Areal Weighted Interpolation">
<meta property="og:description" content="areal">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">areal</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/areal.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/slu-openGIS/areal/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="areal-weighted-interpolation_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Areal Weighted Interpolation</h1>
                        <h4 class="author">Christopher Prener, Ph.D.</h4>
            
            <h4 class="date">2020-05-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slu-openGIS/areal/blob/master/vignettes/areal-weighted-interpolation.Rmd"><code>vignettes/areal-weighted-interpolation.Rmd</code></a></small>
      <div class="hidden name"><code>areal-weighted-interpolation.Rmd</code></div>

    </div>

    
    
<p>Areal weighted interpolation is a technique for estimating the values for overlapping but incongruent polygon features. This article describes the <code>areal</code> package’s approach to areal weighted interpolation. After providing a quick introduction to the technique, the options for <code><a href="../reference/aw_interpolate.html">aw_interpolate()</a></code> are discussed and an example of interpolating data using the manual workflow is provided.</p>
<div id="introduction-to-areal-weighted-interpolation" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-areal-weighted-interpolation" class="anchor"></a>Introduction to Areal Weighted Interpolation</h2>
<p>Areal weighted interpolation is the simplest approach to estimating population values for overlapping polygons. It makes a significant and important assumption - that individuals are spread out <em>evenly</em> within the source features. This assumption quickly breaks down in the real world - areas that have commercial developments mixed in with residential housing, for example, or neighborhoods with a large city park. We do not always have access to this type of contextual data, however, and so areal weighted interpolation remains a popular choice.</p>
<p>Areal weighted interpolation is a multi-step process. The <code>areal</code> package contains a number of example data sets that can be used to illustrate this process:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">areal</span>)

<span class="co"># load data into enviornment</span>
<span class="no">race</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_race</span>                 <span class="co"># census tract population estimates</span>
<span class="no">asthma</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_asthma</span>             <span class="co"># census tract asthma rate estimates</span>
<span class="no">wards</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_wards</span>               <span class="co"># political boundaries</span>
<span class="no">wardsClipped</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_wardsClipped</span> <span class="co"># political boundaries clipped to river</span></pre></body></html></div>
<p>The boundaries for the <code>race</code> and <code>asthma</code> the data are the same - census tracts. When mapped, this is what the census tract and ward features look like:</p>
<p><img src="../man/figures/featureMap.png" width="100%"></p>
<div id="step-1-intersection" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-intersection" class="anchor"></a>Step 1: Intersection</h3>
<p>The first step with areal weighted interpolation is to intersect the data. Imagine one shapefile (we’ll call this the “target”) acting as a cookie cutter - subdividing the features of the other (which we’ll call the “source”) based on areas of overlap such that only those overlapping areas remain (this is important - if these shapefiles do not cover identical areas, those areas only covered by one shapefile will be lost). The number of new features created is entirely dependent on the shapes of the features in the source and target data sets:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># print number of features in source</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">race</span>)
<span class="co">#&gt; [1] 106</span>

<span class="co"># print number of features in target</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">wards</span>)
<span class="co">#&gt; [1] 28</span>

<span class="co"># create intersect for example purposes</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="kw pkg">sf</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_binary_ops.html">st_intersection</a></span>(<span class="no">race</span>, <span class="no">wards</span>)))
<span class="co">#&gt; [1] 287</span></pre></body></html></div>
<p>By intersecting these two data sets, we get a new data set with <em>n</em> = 287 features. The resulting <code>sf</code> object looks like so:</p>
<p><img src="../man/figures/intersectMap.png" width="100%"></p>
<p>One by-product of the intersection process is that each intersected feature takes on the attributes of both the source and target data. The population value of interest from each source feature (for example, total population per tract or <code>TOTAL_E</code>), therefore exists as an attribute for each intersected feature. The identification numbers from both the source (<code>GEOID</code>) and the target data (<code>WARD</code>) are also applied:</p>
<table class="table">
<caption>First Four Rows of Intersected Data</caption>
<thead><tr class="header">
<th align="right">GEOID</th>
<th align="right">TOTAL_E</th>
<th align="right">WARD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">29510101100</td>
<td align="right">2510</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="right">29510101100</td>
<td align="right">2510</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">29510101200</td>
<td align="right">3545</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">29510101200</td>
<td align="right">3545</td>
<td align="right">13</td>
</tr>
</tbody>
</table>
</div>
<div id="step-2-areal-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2-areal-weights" class="anchor"></a>Step 2: Areal Weights</h3>
<p>We then calculate an areal weight for each intersected feature. Let:</p>
<ul>
<li><span class="math inline">\({W}_{i} = \textrm{areal weight for intersected feature i}\)</span></li>
<li><span class="math inline">\({A}_{i} = \textrm{area of intersected feature i}\)</span></li>
<li><span class="math inline">\({A}_{j} = \textrm{total area of source feature j}\)</span></li>
</ul>
<p><span class="math display">\[ {W}_{i} = \frac { {A}_{i} }{ {A}_{j} } \]</span></p>
<p>Since <span class="math inline">\({A}_{j}\)</span> is calculated using the source identification number, the first two observations from table above with the first four rows of intersected data would have the same value for <span class="math inline">\({A}_{j}\)</span>, and the second two observations would also share the same <span class="math inline">\({A}_{j}\)</span>. The resulting values for <span class="math inline">\({W}_{i}\)</span> would therefore be:</p>
<table class="table">
<caption>First Four Rows of Intersected Data</caption>
<thead><tr class="header">
<th align="right">GEOID</th>
<th align="right">TOTAL_E</th>
<th align="right">WARD</th>
<th align="right">Ai</th>
<th align="right">Aj</th>
<th align="right">Wi</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">29510101100</td>
<td align="right">2510</td>
<td align="right">11</td>
<td align="right">355702.9</td>
<td align="right">1257034</td>
<td align="right">0.282970</td>
</tr>
<tr class="even">
<td align="right">29510101100</td>
<td align="right">2510</td>
<td align="right">12</td>
<td align="right">901331.1</td>
<td align="right">1257034</td>
<td align="right">0.717030</td>
</tr>
<tr class="odd">
<td align="right">29510101200</td>
<td align="right">3545</td>
<td align="right">12</td>
<td align="right">875554.7</td>
<td align="right">1084167</td>
<td align="right">0.807583</td>
</tr>
<tr class="even">
<td align="right">29510101200</td>
<td align="right">3545</td>
<td align="right">13</td>
<td align="right">208612.1</td>
<td align="right">1084167</td>
<td align="right">0.192417</td>
</tr>
</tbody>
</table>
</div>
<div id="step-3-estimate-population" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3-estimate-population" class="anchor"></a>Step 3: Estimate Population</h3>
<p>Next, we need to estimate the share of the population value that occupies the intersected feature. Let:</p>
<ul>
<li><span class="math inline">\({E}_{i} = \textrm{estimated value for intersected feature } i\)</span></li>
<li><span class="math inline">\({W}_{i} = \textrm{areal weight for intersected feature } i\)</span></li>
<li><span class="math inline">\({V}_{j} = \textrm{population value for source feature } j\)</span></li>
</ul>
<p><span class="math display">\[ {E}_{i} = {V}_{j}*{W}_{i} \]</span></p>
<p>Using our sample data, we therefore multiply the value (<code>TOTAL_E</code>) by the weight (<code>Wi</code>) to produce our <code>EST</code> estimate column:</p>
<table class="table">
<caption>First Four Rows of Intersected Data</caption>
<thead><tr class="header">
<th align="right">GEOID</th>
<th align="right">TOTAL_E</th>
<th align="right">WARD</th>
<th align="right">Ai</th>
<th align="right">Aj</th>
<th align="right">Wi</th>
<th align="right">EST</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">29510101100</td>
<td align="right">2510</td>
<td align="right">11</td>
<td align="right">355702.9</td>
<td align="right">1257034</td>
<td align="right">0.282970</td>
<td align="right">710.2547</td>
</tr>
<tr class="even">
<td align="right">29510101100</td>
<td align="right">2510</td>
<td align="right">12</td>
<td align="right">901331.1</td>
<td align="right">1257034</td>
<td align="right">0.717030</td>
<td align="right">1799.7450</td>
</tr>
<tr class="odd">
<td align="right">29510101200</td>
<td align="right">3545</td>
<td align="right">12</td>
<td align="right">875554.7</td>
<td align="right">1084167</td>
<td align="right">0.807583</td>
<td align="right">2862.8820</td>
</tr>
<tr class="even">
<td align="right">29510101200</td>
<td align="right">3545</td>
<td align="right">13</td>
<td align="right">208612.1</td>
<td align="right">1084167</td>
<td align="right">0.192417</td>
<td align="right">682.1182</td>
</tr>
</tbody>
</table>
</div>
<div id="step-4-summarize-data" class="section level3">
<h3 class="hasAnchor">
<a href="#step-4-summarize-data" class="anchor"></a>Step 4: Summarize Data</h3>
<p>Finally, we summarize the data based on the target identification number. Let:</p>
<ul>
<li><span class="math inline">\({G}_{k} = \textrm{sum of all estimated values for target feature } k\)</span></li>
<li><span class="math inline">\({E}_{ik} = \textrm{estimated values from intersected features in } i \textrm{ within target feature } k\)</span></li>
</ul>
<p><span class="math display">\[ {G}_{k} = \sum{{E}_{ik}} \]</span></p>
<p>With our hypothetical data, the resulting table would therefore look like:</p>
<table class="table">
<caption>Resulting Target Data</caption>
<thead><tr class="header">
<th align="right">WARD</th>
<th align="right">EST</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">11</td>
<td align="right">710.2547</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">4662.6270</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">682.1182</td>
</tr>
</tbody>
</table>
<p>This process is repeated for each of the <em>n</em> = 287 observations in the intersected data - areal weights are calculated, and the product of the areal weight the source value is summed based on the target identification number.</p>
</div>
</div>
<div id="extensive-and-intensive-interpolations" class="section level2">
<h2 class="hasAnchor">
<a href="#extensive-and-intensive-interpolations" class="anchor"></a>Extensive and Intensive Interpolations</h2>
<div id="extensive-interpolations" class="section level3">
<h3 class="hasAnchor">
<a href="#extensive-interpolations" class="anchor"></a>Extensive Interpolations</h3>
<p>The example above is a spatially <em>extensive</em> interpolation because it involves count data. In <code>areal</code>, these estimates are obtained using the <code><a href="../reference/aw_interpolate.html">aw_interpolate()</a></code> function:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>, <span class="kw">extensive</span> <span class="kw">=</span> <span class="st">"TOTAL_E"</span>)
<span class="co">#&gt; # A tibble: 28 x 4</span>
<span class="co">#&gt;    OBJECTID  WARD       AREA TOTAL_E</span>
<span class="co">#&gt;       &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1        1     1  46138761.   7992.</span>
<span class="co">#&gt;  2        2     2 267817711.  12145.</span>
<span class="co">#&gt;  3        3     3  66291644.   7344.</span>
<span class="co">#&gt;  4        4     4  53210707.   8458.</span>
<span class="co">#&gt;  5        5     5  60462396.   8783.</span>
<span class="co">#&gt;  6        6     6  64337271.  14050.</span>
<span class="co">#&gt;  7        7     7 101268146.  15840.</span>
<span class="co">#&gt;  8        8     8  45966410.  12188.</span>
<span class="co">#&gt;  9        9     9  73993891.  14217.</span>
<span class="co">#&gt; 10       10    10  62915358.  11239.</span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>For spatially extensive interpolations, a list of variable names should be supplied for the argument <code>extensive</code>. This can be a single variable name, such as in the example above, or a vector of variable names:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>,
               <span class="kw">extensive</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOTAL_E"</span>, <span class="st">"WHITE_E"</span>, <span class="st">"BLACK_E"</span>))
<span class="co">#&gt; # A tibble: 28 x 6</span>
<span class="co">#&gt;    OBJECTID  WARD       AREA BLACK_E TOTAL_E WHITE_E</span>
<span class="co">#&gt;       &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1        1     1  46138761.   7779.   7992.    153.</span>
<span class="co">#&gt;  2        2     2 267817711.  10639.  12145.   1323.</span>
<span class="co">#&gt;  3        3     3  66291644.   6635.   7344.    591.</span>
<span class="co">#&gt;  4        4     4  53210707.   8203.   8458.    160.</span>
<span class="co">#&gt;  5        5     5  60462396.   7056.   8783.   1526.</span>
<span class="co">#&gt;  6        6     6  64337271.   7439.  14050.   5840.</span>
<span class="co">#&gt;  7        7     7 101268146.   6629.  15840.   8220.</span>
<span class="co">#&gt;  8        8     8  45966410.   3796.  12188.   7604.</span>
<span class="co">#&gt;  9        9     9  73993891.   6413.  14217.   6838.</span>
<span class="co">#&gt; 10       10    10  62915358.   1667.  11239.   8703.</span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>This ability is a key feature of <code>areal</code> - iteration is built into the package by default, eliminating the need for repeated table joins after interpolations are calculated.</p>
</div>
<div id="calculating-weights-for-extensive-interpolations" class="section level3">
<h3 class="hasAnchor">
<a href="#calculating-weights-for-extensive-interpolations" class="anchor"></a>Calculating Weights for Extensive Interpolations</h3>
<p>The <code>aw_interpolate</code> function also uses an argument <code>weight</code>. There are two options, <code>"sum"</code> and <code>"total"</code>. Each makes a different assumption about the nature of the data and the relationship between the <code>source</code> and <code>target</code> features. For <em>perfectly</em> overlapping data, the distinction between these two options should not matter. In practice, however, there are often deviations in our data even between features that should be perfectly congruous.</p>
<p>The <code>"sum"</code> approach to calculating weights assumes that 100% of the source data should be divided among the target features. When <span class="math inline">\({A}_{j}\)</span> is calculated (see previous section), it is done by taking the sum of the areas for all intersected features (<span class="math inline">\(i\)</span>) within a given source feature (<span class="math inline">\(j\)</span>). Let:</p>
<ul>
<li><span class="math inline">\({A}_{j} = \textrm{total area of source feature j}\)</span></li>
<li><span class="math inline">\({A}_{ij} = \textrm{areas for intersected features in } i \textrm{ within source feature } j\)</span></li>
</ul>
<p><span class="math display">\[ {A}_{j} = \sum{{A}_{ij}} \]</span></p>
<p>On the other hand, the <code>"total"</code> approach to calculating weights assumes that, if a source feature is only covered by 99.88% of the target features, only 99.88% of the source target’s data should be allocated to target features in the interpolation. When <span class="math inline">\({A}_{j}\)</span> is created, the actual area of source feature <span class="math inline">\(j\)</span> is used.</p>
<div id="weights-example-1-non-overlap-due-to-data-quality" class="section level4">
<h4 class="hasAnchor">
<a href="#weights-example-1-non-overlap-due-to-data-quality" class="anchor"></a>Weights Example 1: Non-Overlap Due to Data Quality</h4>
<p>In the example above, <code>race</code> and <code>wards</code> are products of two different agencies. The <code>aw_stl_wards</code> data is a product of the City of the St. Louis and is quite close to fully overlapping with the U.S. Census Bureau’s TIGER boundaries for the city. However, there are a number of very small deviations at the edges where the ward boundaries are <em>smaller</em> than the tracts (but only just so). These deviations result in small portions of census tracts not fitting into any ward.</p>
<p>We can see this in the weights that are used by <code><a href="../reference/aw_interpolate.html">aw_interpolate()</a></code>. The <code><a href="../reference/aw_preview_weights.html">aw_preview_weights()</a></code> function can be used to return a preview of these areal weights.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/aw_preview_weights.html">aw_preview_weights</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="st">"extensive"</span>)
<span class="co">#&gt; # A tibble: 106 x 3</span>
<span class="co">#&gt;    GEOID       extensiveSum extensiveTotal</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 29510101100            1          0.999</span>
<span class="co">#&gt;  2 29510101200            1          1.00 </span>
<span class="co">#&gt;  3 29510101300            1          1.00 </span>
<span class="co">#&gt;  4 29510101400            1          1.00 </span>
<span class="co">#&gt;  5 29510101500            1          0.998</span>
<span class="co">#&gt;  6 29510101800            1          0.978</span>
<span class="co">#&gt;  7 29510102100            1          0.991</span>
<span class="co">#&gt;  8 29510102200            1          0.999</span>
<span class="co">#&gt;  9 29510102300            1          0.999</span>
<span class="co">#&gt; 10 29510102400            1          1.00 </span>
<span class="co">#&gt; # … with 96 more rows</span></pre></body></html></div>
<p>The first tract listed above has a total estimated population of 2510. The practical impact of the weights is that only 2507.072085 individuals will be allocated to wards if the <code>"total"</code> approach to calculating areal weights is used. If <code>"sum"</code> is used, on the other hand, all 2510 individuals would be allocated to wards. In this scenario, the <code>"sum"</code> approach makes more sense because, while the race and ward data do not overlap in practice, they <em>should</em> overlap since no tracts extend out of the city’s boundaries. We therefore want to ensure that all individuals within each tract are allocated out to wards.</p>
<p>With spatially extensive interpolations that utilize the <code>"sum"</code> approach, the sum of the interpolated column should equal the sum of the original source data’s column that was interpolated. This can be verified with <code><a href="../reference/aw_verify.html">aw_verify()</a></code>:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>, <span class="kw">extensive</span> <span class="kw">=</span> <span class="st">"TOTAL_E"</span>)

<span class="fu"><a href="../reference/aw_verify.html">aw_verify</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sourceValue</span> <span class="kw">=</span> <span class="no">TOTAL_E</span>,
          <span class="kw">result</span> <span class="kw">=</span> <span class="no">result</span>, <span class="kw">resultValue</span> <span class="kw">=</span> <span class="no">TOTAL_E</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
<p>This check does <em>not</em> work with the <code>"total"</code> approach to areal weights:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"total"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>, <span class="kw">extensive</span> <span class="kw">=</span> <span class="st">"TOTAL_E"</span>)

<span class="fu"><a href="../reference/aw_verify.html">aw_verify</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sourceValue</span> <span class="kw">=</span> <span class="no">TOTAL_E</span>,
          <span class="kw">result</span> <span class="kw">=</span> <span class="no">result</span>, <span class="kw">resultValue</span> <span class="kw">=</span> <span class="no">TOTAL_E</span>)
<span class="co">#&gt; [1] FALSE</span></pre></body></html></div>
</div>
<div id="weights-example-2-non-overlap-due-to-differing-boundaries" class="section level4">
<h4 class="hasAnchor">
<a href="#weights-example-2-non-overlap-due-to-differing-boundaries" class="anchor"></a>Weights Example 2: Non-Overlap Due to Differing Boundaries</h4>
<p>We can use the <code>aw_stl_wardsClipped</code> data to illustrate a more extreme disparity between source and target data. The <code>aw_stl_wardsClipped</code> data have been modified so that the ward boundaries do not extend past the Mississippi River shoreline, which runs along the entire eastern boundary of the city. When we overlay them on the city’s census tracts, all of the census tracts on the eastern side of the city extend outwards.</p>
<p><img src="../man/figures/overlapMap.png" width="100%"></p>
<p>The difference in weights in this example is more extreme:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/aw_preview_weights.html">aw_preview_weights</a></span>(<span class="no">wardsClipped</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="st">"extensive"</span>)
<span class="co">#&gt; # A tibble: 106 x 3</span>
<span class="co">#&gt;    GEOID       extensiveSum extensiveTotal</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 29510101100            1          0.999</span>
<span class="co">#&gt;  2 29510101200            1          1.00 </span>
<span class="co">#&gt;  3 29510101300            1          1.00 </span>
<span class="co">#&gt;  4 29510101400            1          1.00 </span>
<span class="co">#&gt;  5 29510101500            1          0.998</span>
<span class="co">#&gt;  6 29510101800            1          0.723</span>
<span class="co">#&gt;  7 29510102100            1          0.991</span>
<span class="co">#&gt;  8 29510102200            1          0.999</span>
<span class="co">#&gt;  9 29510102300            1          0.999</span>
<span class="co">#&gt; 10 29510102400            1          1.00 </span>
<span class="co">#&gt; # … with 96 more rows</span></pre></body></html></div>
<p>Only 72.31% of tract <code>29510101800</code>, for example, falls within a ward. In many American cities that lie within larger counties, tract boundaries do not stop at the municipal boundaries in a way that is similar to the difference between tracts and the clipped wards here. In this scenario, we do not want to allocate every individual into our city of interest and the <code>"total"</code> approach to weights is appropriate. Not using <code>"total"</code> would result in an over-count of individuals in our city.</p>
<p>If, on the other hand, we believe that all of the individuals <em>should</em> be allocated into wards, using <code>"total"</code> in this case would result in a severe under-count of individuals.</p>
</div>
</div>
<div id="intensive-interpolations" class="section level3">
<h3 class="hasAnchor">
<a href="#intensive-interpolations" class="anchor"></a>Intensive Interpolations</h3>
<p>Spatially <em>intensive</em> operations are used when the data to be interpolated are, for example, a percentage or density value. An example of these data can be found in <code>ar_stl_asthma</code>, which contains asthma rates for each census tract in the city. The interpolation process is very similar to the spatially extensive workflow, except with how the areal weight is calculated. Instead of using the source data’s area for reference, the <em>target</em> data is used in the denominator. Let:</p>
<ul>
<li><span class="math inline">\({W}_{i} = \textrm{areal weight for intersected feature i}\)</span></li>
<li><span class="math inline">\({A}_{i} = \textrm{area of intersected feature i}\)</span></li>
<li><span class="math inline">\({A}_{ik} = \textrm{areas for intersected features in } i \textrm{ within target feature } k\)</span></li>
</ul>
<p><span class="math display">\[ {W}_{i} = \frac { {A}_{i} }{ \sum{{A}_{ik}} } \]</span></p>
<p>Like spatially extensive interpolations that use the <code>"sum"</code> approach, the weights for intensive interpolations should always be equal to 1 as well.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/aw_preview_weights.html">aw_preview_weights</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">asthma</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
                   <span class="kw">type</span> <span class="kw">=</span> <span class="st">"intensive"</span>)
<span class="co">#&gt; # A tibble: 28 x 2</span>
<span class="co">#&gt;     WARD intensive</span>
<span class="co">#&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1      1.00</span>
<span class="co">#&gt;  2     2      1   </span>
<span class="co">#&gt;  3     3      1   </span>
<span class="co">#&gt;  4     4      1   </span>
<span class="co">#&gt;  5     5      1   </span>
<span class="co">#&gt;  6     6      1   </span>
<span class="co">#&gt;  7     7      1.00</span>
<span class="co">#&gt;  8     8      1   </span>
<span class="co">#&gt;  9     9      1   </span>
<span class="co">#&gt; 10    10      1   </span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>We can calculate the intensive interpolation by specifying a variable name for the <code>intensive</code> argument in <code><a href="../reference/aw_interpolate.html">aw_interpolate()</a></code> and omitting the <code>extensive</code> argument:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">asthma</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>, <span class="kw">intensive</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>)
<span class="co">#&gt; # A tibble: 28 x 4</span>
<span class="co">#&gt;    OBJECTID  WARD       AREA ASTHMA</span>
<span class="co">#&gt;       &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1        1     1  46138761.  13.4 </span>
<span class="co">#&gt;  2        2     2 267817711.  13.2 </span>
<span class="co">#&gt;  3        3     3  66291644.  14.1 </span>
<span class="co">#&gt;  4        4     4  53210707.  13.6 </span>
<span class="co">#&gt;  5        5     5  60462396.  13.8 </span>
<span class="co">#&gt;  6        6     6  64337271.  11.7 </span>
<span class="co">#&gt;  7        7     7 101268146.   9.72</span>
<span class="co">#&gt;  8        8     8  45966410.   9.82</span>
<span class="co">#&gt;  9        9     9  73993891.  11.8 </span>
<span class="co">#&gt; 10       10    10  62915358.   9.44</span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>This gives us an estimate of the asthma rates at the ward level.</p>
</div>
<div id="mixed-interpolations" class="section level3">
<h3 class="hasAnchor">
<a href="#mixed-interpolations" class="anchor"></a>Mixed Interpolations</h3>
<p><code>areal</code> also provides support for “mixed” interpolations where both spatially extensive and intensive interpolations need to be calculated. We specify a variable name or a vector of variable names for <em>both</em> the <code>intensive</code> and <code>extensive</code> arguments:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># remove sf geometry</span>
<span class="fu">st_geometry</span>(<span class="no">race</span>) <span class="kw">&lt;-</span> <span class="kw">NULL</span>

<span class="co"># create combined data</span>
<span class="no">race</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">GEOID</span>, <span class="no">TOTAL_E</span>, <span class="no">WHITE_E</span>, <span class="no">BLACK_E</span>) <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">asthma</span>, <span class="no">.</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"GEOID"</span>) <span class="kw">-&gt;</span> <span class="no">combinedData</span>

<span class="co"># interpolate</span>
<span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">combinedData</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>, <span class="kw">intensive</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>,
               <span class="kw">extensive</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOTAL_E"</span>, <span class="st">"WHITE_E"</span>, <span class="st">"BLACK_E"</span>))
<span class="co">#&gt; # A tibble: 28 x 7</span>
<span class="co">#&gt;    OBJECTID  WARD       AREA BLACK_E TOTAL_E WHITE_E ASTHMA</span>
<span class="co">#&gt;       &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1        1     1  46138761.   7779.   7992.    153.  13.4 </span>
<span class="co">#&gt;  2        2     2 267817711.  10639.  12145.   1323.  13.2 </span>
<span class="co">#&gt;  3        3     3  66291644.   6635.   7344.    591.  14.1 </span>
<span class="co">#&gt;  4        4     4  53210707.   8203.   8458.    160.  13.6 </span>
<span class="co">#&gt;  5        5     5  60462396.   7056.   8783.   1526.  13.8 </span>
<span class="co">#&gt;  6        6     6  64337271.   7439.  14050.   5840.  11.7 </span>
<span class="co">#&gt;  7        7     7 101268146.   6629.  15840.   8220.   9.72</span>
<span class="co">#&gt;  8        8     8  45966410.   3796.  12188.   7604.   9.82</span>
<span class="co">#&gt;  9        9     9  73993891.   6413.  14217.   6838.  11.8 </span>
<span class="co">#&gt; 10       10    10  62915358.   1667.  11239.   8703.   9.44</span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>Users should take care to consider the implications of interpolating multiple values, such as total population and the number of African American residents (both extensive), and then calculating a spatially intensive variable from them such as percent African American. Doing so in multiple steps, and thereby treating extensive and intensive values as independent, may result in estimates that differ from a single step process where the percent of African American residents is interpoltated directly.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># re-load data</span>
<span class="no">race</span> <span class="kw">&lt;-</span> <span class="no">ar_stl_race</span>

<span class="co"># create combined data</span>
<span class="no">race</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">GEOID</span>, <span class="no">WHITE_E</span>, <span class="no">BLACK_E</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">TOTAL</span> <span class="kw">=</span> <span class="no">WHITE_E</span>+<span class="no">BLACK_E</span>,
    <span class="kw">WHITE_PCT</span> <span class="kw">=</span> <span class="no">WHITE_E</span>/<span class="no">TOTAL</span>,
    <span class="kw">BLACK_PCT</span> <span class="kw">=</span> <span class="no">BLACK_E</span>/<span class="no">TOTAL</span>,
    <span class="kw">TOTAL_PCT</span> <span class="kw">=</span> <span class="no">WHITE_PCT</span>+<span class="no">BLACK_PCT</span>
  ) <span class="kw">-&gt;</span> <span class="no">constrainedData</span>

<span class="co"># interpolate</span>
<span class="no">result2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">ar_stl_wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>,
               <span class="kw">source</span> <span class="kw">=</span> <span class="no">constrainedData</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>,
               <span class="kw">intensive</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"WHITE_PCT"</span>, <span class="st">"BLACK_PCT"</span>, <span class="st">"TOTAL_PCT"</span>),
               <span class="kw">extensive</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOTAL"</span>, <span class="st">"WHITE_E"</span>, <span class="st">"BLACK_E"</span>))

<span class="co"># calculate new percentages</span>
<span class="no">result2</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">WHITE_PCT_2</span> <span class="kw">=</span> <span class="no">WHITE_E</span>/<span class="no">TOTAL</span>,
    <span class="kw">BLACK_PCT_2</span> <span class="kw">=</span> <span class="no">BLACK_E</span>/<span class="no">TOTAL</span>,
    <span class="kw">TOTAL_PCT_2</span> <span class="kw">=</span> <span class="no">WHITE_PCT_2</span>+<span class="no">BLACK_PCT_2</span>
  ) <span class="kw">-&gt;</span> <span class="no">result2</span>

<span class="co"># display</span>
<span class="no">result2</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">WHITE_PCT</span>, <span class="no">WHITE_PCT_2</span>, <span class="no">BLACK_PCT</span>, <span class="no">BLACK_PCT_2</span>, <span class="no">TOTAL_PCT</span>, <span class="no">TOTAL_PCT_2</span>)
<span class="co">#&gt; # A tibble: 28 x 6</span>
<span class="co">#&gt;    WHITE_PCT WHITE_PCT_2 BLACK_PCT BLACK_PCT_2 TOTAL_PCT TOTAL_PCT_2</span>
<span class="co">#&gt;        &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1    0.0195      0.0193     0.980       0.981      1.00        1   </span>
<span class="co">#&gt;  2    0.177       0.111      0.823       0.889      1           1.00</span>
<span class="co">#&gt;  3    0.104       0.0818     0.896       0.918      1           1   </span>
<span class="co">#&gt;  4    0.0252      0.0191     0.975       0.981      1           1   </span>
<span class="co">#&gt;  5    0.174       0.178      0.826       0.822      1           1.00</span>
<span class="co">#&gt;  6    0.409       0.440      0.591       0.560      1           1.  </span>
<span class="co">#&gt;  7    0.575       0.554      0.425       0.446      1.00        1   </span>
<span class="co">#&gt;  8    0.700       0.667      0.300       0.333      1           1   </span>
<span class="co">#&gt;  9    0.505       0.516      0.495       0.484      1           1   </span>
<span class="co">#&gt; 10    0.862       0.839      0.138       0.161      1           1.  </span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>Note that there are a number of points of departure between the data interpolated as intensive values (<code>WHITE_PCT</code>, <code>BLACK_PCT</code>) and those that were interpolated as count data (i.e. extensive values) and then converted to intensive variables (<code>WHITE_PCT_2</code> and <code>BLACK_PCT_2</code>).</p>
</div>
</div>
<div id="output-options" class="section level2">
<h2 class="hasAnchor">
<a href="#output-options" class="anchor"></a>Output Options</h2>
<p>All of the above examples have created a tibble for output, but <code>areal</code> also supports the creation of <code>sf</code> objects as well:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">asthma</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
               <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"sf"</span>, <span class="kw">intensive</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>)
<span class="co">#&gt; Simple feature collection with 28 features and 4 fields</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 733361.8 ymin: 4268336 xmax: 746157.7 ymax: 4295504</span>
<span class="co">#&gt; CRS:            EPSG:26915</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    OBJECTID WARD      AREA    ASTHMA                       geometry</span>
<span class="co">#&gt; 1         1    1  46138761 13.379577 POLYGON ((740184.2 4286431,...</span>
<span class="co">#&gt; 2         2    2 267817711 13.164879 POLYGON ((742392.1 4289178,...</span>
<span class="co">#&gt; 3         3    3  66291644 14.108107 POLYGON ((742956.1 4284113,...</span>
<span class="co">#&gt; 4         4    4  53210707 13.613989 POLYGON ((739557.6 4284080,...</span>
<span class="co">#&gt; 5         5    5  60462396 13.789757 POLYGON ((744883.8 4281632,...</span>
<span class="co">#&gt; 6         6    6  64337271 11.747642 POLYGON ((742501.6 4279976,...</span>
<span class="co">#&gt; 7         7    7 101268146  9.722839 POLYGON ((745618.6 4279867,...</span>
<span class="co">#&gt; 8         8    8  45966410  9.823627 POLYGON ((739842.8 4277724,...</span>
<span class="co">#&gt; 9         9    9  73993891 11.820622 POLYGON ((742619.4 4276734,...</span>
<span class="co">#&gt; 10       10   10  62915358  9.439929 POLYGON ((737257.7 4277050,...</span></pre></body></html></div>
</div>
<div id="other-features-of-aw_interpolate" class="section level2">
<h2 class="hasAnchor">
<a href="#other-features-of-aw_interpolate" class="anchor"></a>Other Features of aw_interpolate</h2>
<p>The <code>sf</code> option will include <em>all</em> of the variables that were included in the original target data. The <code><a href="../reference/aw_interpolate.html">aw_interpolate()</a></code> function is pipe-able, allowing for existing tidyverse workflows to be integrated into the interpolation process. For example, if we wanted to remove the <code>OBJECTID</code> and <code>AREA</code> columns because they are not needed, this can be accomplished easily with <code>areal</code> and <code>dplyr</code>:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">wards</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">OBJECTID</span>, -<span class="no">AREA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">asthma</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="no">GEOID</span>,
                 <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>, <span class="kw">intensive</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>)
<span class="co">#&gt; # A tibble: 28 x 2</span>
<span class="co">#&gt;     WARD ASTHMA</span>
<span class="co">#&gt;    &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1  13.4 </span>
<span class="co">#&gt;  2     2  13.2 </span>
<span class="co">#&gt;  3     3  14.1 </span>
<span class="co">#&gt;  4     4  13.6 </span>
<span class="co">#&gt;  5     5  13.8 </span>
<span class="co">#&gt;  6     6  11.7 </span>
<span class="co">#&gt;  7     7   9.72</span>
<span class="co">#&gt;  8     8   9.82</span>
<span class="co">#&gt;  9     9  11.8 </span>
<span class="co">#&gt; 10    10   9.44</span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>All of the <code>areal</code> functions that are exported support non-standard evaluation, meaning that inputs can be either unquoted as they are above or quoted:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">wards</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">OBJECTID</span>, -<span class="no">AREA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/aw_interpolate.html">aw_interpolate</a></span>(<span class="kw">tid</span> <span class="kw">=</span> <span class="st">"WARD"</span>, <span class="kw">source</span> <span class="kw">=</span> <span class="no">asthma</span>, <span class="kw">sid</span> <span class="kw">=</span> <span class="st">"GEOID"</span>,
                 <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"tibble"</span>, <span class="kw">intensive</span> <span class="kw">=</span> <span class="st">"ASTHMA"</span>)
<span class="co">#&gt; # A tibble: 28 x 2</span>
<span class="co">#&gt;     WARD ASTHMA</span>
<span class="co">#&gt;    &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1  13.4 </span>
<span class="co">#&gt;  2     2  13.2 </span>
<span class="co">#&gt;  3     3  14.1 </span>
<span class="co">#&gt;  4     4  13.6 </span>
<span class="co">#&gt;  5     5  13.8 </span>
<span class="co">#&gt;  6     6  11.7 </span>
<span class="co">#&gt;  7     7   9.72</span>
<span class="co">#&gt;  8     8   9.82</span>
<span class="co">#&gt;  9     9  11.8 </span>
<span class="co">#&gt; 10    10   9.44</span>
<span class="co">#&gt; # … with 18 more rows</span></pre></body></html></div>
<p>This functionality is not available for the <code>intensive</code> and <code>extensive</code> arguments at this time.</p>
</div>
<div id="manual-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#manual-workflow" class="anchor"></a>Manual Workflow</h2>
<p><code>areal</code> purposely exports the sub-functions that are called by <code><a href="../reference/aw_interpolate.html">aw_interpolate()</a></code> so that the interpolation process is not a “black box” but rather can be recreated manually. This is envisioned as a diagnostic toolkit, with the final interpolations estimated using the simpler <code><a href="../reference/aw_interpolate.html">aw_interpolate()</a></code> function once any issues have been identified and ameliorated</p>
<p>First, we’ll prepare the data but retaining only the columns we are interested in from the source data using the <code>select()</code> function from <code>dplyr</code>:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">race</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">ar_stl_race</span>, <span class="no">GEOID</span>, <span class="no">TOTAL_E</span>)
<span class="no">wards</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">wards</span>, -<span class="no">OBJECTID</span>, -<span class="no">AREA</span>)</pre></body></html></div>
<p>We want to be careful to retain both a column with a value to be interpolated (total population in this case, <code>TOTAL_E</code>) and a column with a unique identification number (<code>GEOID</code> in this case).</p>
<div id="intersect-data" class="section level3">
<h3 class="hasAnchor">
<a href="#intersect-data" class="anchor"></a>Intersect Data</h3>
<p>As we noted above, the interpolation process begins with calculating the intersection between the source and target data. We use the function <code><a href="../reference/aw_intersect.html">aw_intersect()</a></code> to accomplish this:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">wards</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/aw_intersect.html">aw_intersect</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">areaVar</span> <span class="kw">=</span> <span class="st">"area"</span>) <span class="kw">-&gt;</span> <span class="no">intersect</span>

<span class="no">intersect</span>
<span class="co">#&gt; Simple feature collection with 287 features and 4 fields</span>
<span class="co">#&gt; geometry type:  GEOMETRY</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 733361.8 ymin: 4268411 xmax: 746155.7 ymax: 4295504</span>
<span class="co">#&gt; CRS:            EPSG:26915</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;          GEOID TOTAL_E WARD                       geometry         area</span>
<span class="co">#&gt; 1  29510106500    2863    1 POLYGON ((738110.9 4283989,... 4.271176e+05</span>
<span class="co">#&gt; 2  29510106700    3168    1 POLYGON ((738335.2 4283055,... 5.946820e+05</span>
<span class="co">#&gt; 3  29510107500    1991    1 POLYGON ((740111.6 4286547,... 6.146361e+05</span>
<span class="co">#&gt; 4  29510107600    1958    1 POLYGON ((739386.1 4285082,... 1.071347e+06</span>
<span class="co">#&gt; 5  29510110100    2820    1 POLYGON ((739542.5 4283728,... 5.563665e+01</span>
<span class="co">#&gt; 6  29510109600    3050    1 POLYGON ((740899.6 4285240,... 3.586828e+03</span>
<span class="co">#&gt; 7  29510126900    4462    1 POLYGON ((739115.9 4285807,... 8.903340e+05</span>
<span class="co">#&gt; 8  29510127000    1826    1 MULTIPOLYGON (((740936.1 42... 1.015451e+03</span>
<span class="co">#&gt; 9  29510106400    1986    1 POLYGON ((738500.9 4284750,... 6.866924e+05</span>
<span class="co">#&gt; 10 29510108100    3309    1 POLYGON ((740163.9 4286467,... 1.198667e+02</span></pre></body></html></div>
<p>Note that <code><a href="../reference/aw_intersect.html">aw_intersect()</a></code> automatically calculates the area of the intersected feature.</p>
</div>
<div id="calculate-total-area" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-total-area" class="anchor"></a>Calculate Total Area</h3>
<p>Next, we want to apply the total area of our source features to our data using <code><a href="../reference/aw_total.html">aw_total()</a></code>. This will implement the correct areal weighting approach based on the <code>type</code> and <code>weight</code> arguments. We’ll use the <code>"sum"</code> approach to areal weights here:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">intersect</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/aw_total.html">aw_total</a></span>(<span class="kw">source</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">id</span> <span class="kw">=</span> <span class="no">GEOID</span>, <span class="kw">areaVar</span> <span class="kw">=</span> <span class="st">"area"</span>, <span class="kw">totalVar</span> <span class="kw">=</span> <span class="st">"totalArea"</span>,
             <span class="kw">type</span> <span class="kw">=</span> <span class="st">"extensive"</span>, <span class="kw">weight</span> <span class="kw">=</span> <span class="st">"sum"</span>) <span class="kw">-&gt;</span> <span class="no">intersect</span>

<span class="no">intersect</span>
<span class="co">#&gt; Simple feature collection with 287 features and 5 fields</span>
<span class="co">#&gt; geometry type:  GEOMETRY</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 733361.8 ymin: 4268411 xmax: 746155.7 ymax: 4295504</span>
<span class="co">#&gt; CRS:            EPSG:26915</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;          GEOID TOTAL_E WARD         area  totalArea</span>
<span class="co">#&gt; 1  29510106500    2863    1 4.271176e+05  1064776.2</span>
<span class="co">#&gt; 2  29510106700    3168    1 5.946820e+05  1239241.5</span>
<span class="co">#&gt; 3  29510107500    1991    1 6.146361e+05   912325.0</span>
<span class="co">#&gt; 4  29510107600    1958    1 1.071347e+06  1146634.4</span>
<span class="co">#&gt; 5  29510110100    2820    1 5.563665e+01   994606.5</span>
<span class="co">#&gt; 6  29510109600    3050    1 3.586828e+03  3157835.4</span>
<span class="co">#&gt; 7  29510126900    4462    1 8.903340e+05  4334701.5</span>
<span class="co">#&gt; 8  29510127000    1826    1 1.015451e+03 14726832.5</span>
<span class="co">#&gt; 9  29510106400    1986    1 6.866924e+05  1107191.4</span>
<span class="co">#&gt; 10 29510108100    3309    1 1.198667e+02  3216478.2</span>
<span class="co">#&gt;                          geometry</span>
<span class="co">#&gt; 1  POLYGON ((738110.9 4283989,...</span>
<span class="co">#&gt; 2  POLYGON ((738335.2 4283055,...</span>
<span class="co">#&gt; 3  POLYGON ((740111.6 4286547,...</span>
<span class="co">#&gt; 4  POLYGON ((739386.1 4285082,...</span>
<span class="co">#&gt; 5  POLYGON ((739542.5 4283728,...</span>
<span class="co">#&gt; 6  POLYGON ((740899.6 4285240,...</span>
<span class="co">#&gt; 7  POLYGON ((739115.9 4285807,...</span>
<span class="co">#&gt; 8  MULTIPOLYGON (((740936.1 42...</span>
<span class="co">#&gt; 9  POLYGON ((738500.9 4284750,...</span>
<span class="co">#&gt; 10 POLYGON ((740163.9 4286467,...</span></pre></body></html></div>
<p>Changing <code>type</code> to <code>"intensive"</code> would be necessary for spatially intensive interpolations. Likewise, changing <code>weight</code> to <code>"total"</code> is necessary if areas that lack overlap should not be allocated into the target features.</p>
</div>
<div id="calculate-areal-weight" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-areal-weight" class="anchor"></a>Calculate Areal Weight</h3>
<p>With the total weight in hand, we are ready to calculate the areal weight itself using <code><a href="../reference/aw_weight.html">aw_weight()</a></code>.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">intersect</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/aw_weight.html">aw_weight</a></span>(<span class="kw">areaVar</span> <span class="kw">=</span> <span class="st">"area"</span>, <span class="kw">totalVar</span> <span class="kw">=</span> <span class="st">"totalArea"</span>,
            <span class="kw">areaWeight</span> <span class="kw">=</span> <span class="st">"areaWeight"</span>) <span class="kw">-&gt;</span> <span class="no">intersect</span>

<span class="no">intersect</span>
<span class="co">#&gt; Simple feature collection with 287 features and 6 fields</span>
<span class="co">#&gt; geometry type:  GEOMETRY</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 733361.8 ymin: 4268411 xmax: 746155.7 ymax: 4295504</span>
<span class="co">#&gt; CRS:            EPSG:26915</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;          GEOID TOTAL_E WARD         area  totalArea</span>
<span class="co">#&gt; 1  29510106500    2863    1 4.271176e+05  1064776.2</span>
<span class="co">#&gt; 2  29510106700    3168    1 5.946820e+05  1239241.5</span>
<span class="co">#&gt; 3  29510107500    1991    1 6.146361e+05   912325.0</span>
<span class="co">#&gt; 4  29510107600    1958    1 1.071347e+06  1146634.4</span>
<span class="co">#&gt; 5  29510110100    2820    1 5.563665e+01   994606.5</span>
<span class="co">#&gt; 6  29510109600    3050    1 3.586828e+03  3157835.4</span>
<span class="co">#&gt; 7  29510126900    4462    1 8.903340e+05  4334701.5</span>
<span class="co">#&gt; 8  29510127000    1826    1 1.015451e+03 14726832.5</span>
<span class="co">#&gt; 9  29510106400    1986    1 6.866924e+05  1107191.4</span>
<span class="co">#&gt; 10 29510108100    3309    1 1.198667e+02  3216478.2</span>
<span class="co">#&gt;                          geometry   areaWeight</span>
<span class="co">#&gt; 1  POLYGON ((738110.9 4283989,... 4.011337e-01</span>
<span class="co">#&gt; 2  POLYGON ((738335.2 4283055,... 4.798758e-01</span>
<span class="co">#&gt; 3  POLYGON ((740111.6 4286547,... 6.737030e-01</span>
<span class="co">#&gt; 4  POLYGON ((739386.1 4285082,... 9.343406e-01</span>
<span class="co">#&gt; 5  POLYGON ((739542.5 4283728,... 5.593835e-05</span>
<span class="co">#&gt; 6  POLYGON ((740899.6 4285240,... 1.135850e-03</span>
<span class="co">#&gt; 7  POLYGON ((739115.9 4285807,... 2.053968e-01</span>
<span class="co">#&gt; 8  MULTIPOLYGON (((740936.1 42... 6.895245e-05</span>
<span class="co">#&gt; 9  POLYGON ((738500.9 4284750,... 6.202111e-01</span>
<span class="co">#&gt; 10 POLYGON ((740163.9 4286467,... 3.726645e-05</span></pre></body></html></div>
</div>
<div id="calculate-estimated-population" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-estimated-population" class="anchor"></a>Calculate Estimated Population</h3>
<p>We can then multiply the value (<code>TOTAL_E</code>) by the weight (<code>areaWeight</code>) to get a population estimate for each intersected feature using <code><a href="../reference/aw_calculate.html">aw_calculate()</a></code>:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">intersect</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/aw_calculate.html">aw_calculate</a></span>(<span class="kw">value</span> <span class="kw">=</span> <span class="no">TOTAL_E</span>, <span class="kw">areaWeight</span> <span class="kw">=</span> <span class="st">"areaWeight"</span>) <span class="kw">-&gt;</span> <span class="no">intersect</span>

<span class="no">intersect</span>
<span class="co">#&gt; Simple feature collection with 287 features and 6 fields</span>
<span class="co">#&gt; geometry type:  GEOMETRY</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 733361.8 ymin: 4268411 xmax: 746155.7 ymax: 4295504</span>
<span class="co">#&gt; CRS:            EPSG:26915</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;          GEOID      TOTAL_E WARD         area  totalArea</span>
<span class="co">#&gt; 1  29510106500 1148.4457826    1 4.271176e+05  1064776.2</span>
<span class="co">#&gt; 2  29510106700 1520.2464178    1 5.946820e+05  1239241.5</span>
<span class="co">#&gt; 3  29510107500 1341.3426720    1 6.146361e+05   912325.0</span>
<span class="co">#&gt; 4  29510107600 1829.4388297    1 1.071347e+06  1146634.4</span>
<span class="co">#&gt; 5  29510110100    0.1577461    1 5.563665e+01   994606.5</span>
<span class="co">#&gt; 6  29510109600    3.4643427    1 3.586828e+03  3157835.4</span>
<span class="co">#&gt; 7  29510126900  916.4807234    1 8.903340e+05  4334701.5</span>
<span class="co">#&gt; 8  29510127000    0.1259072    1 1.015451e+03 14726832.5</span>
<span class="co">#&gt; 9  29510106400 1231.7392274    1 6.866924e+05  1107191.4</span>
<span class="co">#&gt; 10 29510108100    0.1233147    1 1.198667e+02  3216478.2</span>
<span class="co">#&gt;                          geometry   areaWeight</span>
<span class="co">#&gt; 1  POLYGON ((738110.9 4283989,... 4.011337e-01</span>
<span class="co">#&gt; 2  POLYGON ((738335.2 4283055,... 4.798758e-01</span>
<span class="co">#&gt; 3  POLYGON ((740111.6 4286547,... 6.737030e-01</span>
<span class="co">#&gt; 4  POLYGON ((739386.1 4285082,... 9.343406e-01</span>
<span class="co">#&gt; 5  POLYGON ((739542.5 4283728,... 5.593835e-05</span>
<span class="co">#&gt; 6  POLYGON ((740899.6 4285240,... 1.135850e-03</span>
<span class="co">#&gt; 7  POLYGON ((739115.9 4285807,... 2.053968e-01</span>
<span class="co">#&gt; 8  MULTIPOLYGON (((740936.1 42... 6.895245e-05</span>
<span class="co">#&gt; 9  POLYGON ((738500.9 4284750,... 6.202111e-01</span>
<span class="co">#&gt; 10 POLYGON ((740163.9 4286467,... 3.726645e-05</span></pre></body></html></div>
<p>There is an optional <code>newVar</code> argument that can be used to store the estimates in a new column rather than in the existing <code>value</code> column.</p>
</div>
<div id="aggregate-estimated-population-by-target-id" class="section level3">
<h3 class="hasAnchor">
<a href="#aggregate-estimated-population-by-target-id" class="anchor"></a>Aggregate Estimated Population by Target ID</h3>
<p>Finally, we aggregate the estimated values by target features using <code><a href="../reference/aw_aggregate.html">aw_aggregate()</a></code>:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">intersect</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/aw_aggregate.html">aw_aggregate</a></span>(<span class="kw">target</span> <span class="kw">=</span> <span class="no">wards</span>, <span class="kw">tid</span> <span class="kw">=</span> <span class="no">WARD</span>, <span class="kw">interVar</span> <span class="kw">=</span> <span class="no">TOTAL_E</span>) <span class="kw">-&gt;</span> <span class="no">result</span>

<span class="no">result</span>
<span class="co">#&gt; Simple feature collection with 28 features and 2 fields</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 733361.8 ymin: 4268336 xmax: 746157.7 ymax: 4295504</span>
<span class="co">#&gt; CRS:            EPSG:26915</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    WARD   TOTAL_E                       geometry</span>
<span class="co">#&gt; 1     1  7991.565 POLYGON ((740184.2 4286431,...</span>
<span class="co">#&gt; 2     2 12145.021 POLYGON ((742392.1 4289178,...</span>
<span class="co">#&gt; 3     3  7344.287 POLYGON ((742956.1 4284113,...</span>
<span class="co">#&gt; 4     4  8457.672 POLYGON ((739557.6 4284080,...</span>
<span class="co">#&gt; 5     5  8783.377 POLYGON ((744883.8 4281632,...</span>
<span class="co">#&gt; 6     6 14050.399 POLYGON ((742501.6 4279976,...</span>
<span class="co">#&gt; 7     7 15840.086 POLYGON ((745618.6 4279867,...</span>
<span class="co">#&gt; 8     8 12188.131 POLYGON ((739842.8 4277724,...</span>
<span class="co">#&gt; 9     9 14217.149 POLYGON ((742619.4 4276734,...</span>
<span class="co">#&gt; 10   10 11239.213 POLYGON ((737257.7 4277050,...</span></pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://chris-prener.github.io">Christopher Prener</a>, Charlie Revord, Branson Fox.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
